{% extends "layout.html" %}

{% block content %}
<h2 class="text-center">ุงูุชูุงุฑูุฑ</h2>

<!-- ูููุฐุฌ ุงูุจุญุซ ุจุงูุตูุช ูุงููุชุงุจุฉ -->
<div class="search-container text-center">
    <h3>ุงุจุญุซ ุนู ุงููุดุฑูุน</h3>
    <input type="text" id="text-search" class="form-control w-50 d-inline" placeholder="ุงุฏุฎู ุงุณู ุงููุดุฑูุน">
    <button class="btn btn-primary" onclick="searchByText()">ุจุญุซ</button>
    <button class="btn btn-secondary" onclick="startVoiceRecognition()">๐ ุจุญุซ ุจุงูุตูุช</button>
</div>

<!-- ุฌุฏูู ุนุฑุถ ุงูุชูุงุฑูุฑ ูุน ุงูุญููู ุงูุฌุฏูุฏุฉ -->
<div class="table-responsive mt-4">
    <table class="table table-bordered text-center">
        <thead class="table-dark">
            <tr>
                <th>ุงูุชุณูุณู</th>
                <th>ุงููุญุงูุธุฉ</th>
                <th>ุงููุดุฑูุน</th>
                <th>ุงููููุฉ ุงููููุฉ</th>
                <th>ุงูุฅุนูุงู</th>
                <th>ุชุงุฑูุฎ ุบูู ุงูุฏุนูุงุช</th>
                <th>ูุฌูุฉ ุชุญููู</th>
                <th>ูุฑุงุฑ ูุฌูุฉ ุงูุชุญููู ุงูู ุฏุงุฆุฑุฉ ุงูุนููุฏ</th>
                <th>ูุฌูุฉ ุงููุฑุงุฌุนุฉ ูุงููุตุงุฏูุฉ</th>
                <th>ุงูุฅุญุงูุฉ</th>
                <th>ูุณูุฏุฉ ุงูุนูุฏ</th>
                <th>ุชูููุน ุงูุนูุฏ</th>
                <th>ููุงุญุธุงุช</th>
            </tr>
        </thead>
        <tbody>
            {% for report in reports %}
            <tr>
                <td>{{ report[1] }}</td>
                <td>{{ report[2] }}</td>
                <td>{{ report[3] }}</td>
                <td>{{ report[5] }}</td>
                <td>{{ report[9] }}</td>
                <td>{{ report[13] }}</td>
                <td>{{ report[15] }}</td>
                <td>{{ report[16] }}</td>
                <td>{{ report[18] }}</td>
                <td>{{ report[19] }}</td>
                <td>{{ report[20] }}</td>
                <td>{{ report[21] }}</td>
                <td>{{ report[22] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    // ุงูุจุญุซ ุนู ุทุฑูู ุงููุชุงุจุฉ
    function searchByText() {
        let projectName = document.getElementById('text-search').value;
        fetch('/search_reports', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ project_name: projectName })
        })
        .then(response => response.json())
        .then(data => {
            updateReportTable(data);
        })
        .catch(error => console.error('Error:', error));
    }

    // ุงูุจุญุซ ุนู ุทุฑูู ุงูุตูุช
    function startVoiceRecognition() {
        if (annyang) {
            let commands = {
                'ุงุจุญุซ ุนู *name': function(name) {
                    document.getElementById('text-search').value = name;
                    searchByText();
                }
            };
            annyang.addCommands(commands);
            annyang.start();
        }
    }

    // ุชุญุฏูุซ ุงูุฌุฏูู ุจุงููุชุงุฆุฌ ุงูุฌุฏูุฏุฉ
    function updateReportTable(data) {
        let tableBody = document.querySelector('tbody');
        tableBody.innerHTML = '';
        data.forEach(report => {
            let row = `<tr>
                <td>${report[1]}</td>
                <td>${report[2]}</td>
                <td>${report[3]}</td>
                <td>${report[5]}</td>
                <td>${report[9]}</td>
                <td>${report[13]}</td>
                <td>${report[15]}</td>
                <td>${report[16]}</td>
                <td>${report[18]}</td>
                <td>${report[19]}</td>
                <td>${report[20]}</td>
                <td>${report[21]}</td>
                <td>${report[22]}</td>
            </tr>`;
            tableBody.innerHTML += row;
        });
    }
</script>

{% endblock %}
